var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
define(["require", "exports", "../map/DunGen", "./Decorator"], function (require, exports, DunGen_1, Decorator_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var ClassicTileProvider = /** @class */ (function () {
        function ClassicTileProvider() {
        }
        ClassicTileProvider_1 = ClassicTileProvider;
        ClassicTileProvider.ready = function () {
            var _this = this;
            var p = new Promise(function (resolve, reject) {
                if (!_this.textureSheet) {
                    PIXI.loader.add("tiles", "img/tiles_001.png");
                    PIXI.loader.load();
                    PIXI.loader.once("complete", function () {
                        _this.textureSheet = PIXI.loader.resources["tiles"].texture;
                        resolve();
                    });
                }
                else {
                    resolve();
                }
            });
            return p;
        };
        ClassicTileProvider.isReady = function () {
            return this.textureSheet !== undefined;
        };
        ClassicTileProvider.getTile = function (dungeon, x, y) {
            var texX = 0;
            var texY = 0;
            var tile = dungeon.tiles.get(x, y);
            if (tile === DunGen_1.ETiles.EMPTY) {
                texX = 5;
                texY = 1;
            }
            else if (tile === DunGen_1.ETiles.LADDER) {
                texX = 5;
                texY = 2;
            }
            else if (tile === DunGen_1.ETiles.WALL) {
                var solidTop = y === 0 || dungeon.tiles.get(x, y - 1) === DunGen_1.ETiles.WALL;
                var solidBottom = y === dungeon.height - 1 || dungeon.tiles.get(x, y + 1) === DunGen_1.ETiles.WALL;
                var solidLeft = x === 0 || dungeon.tiles.get(x - 1, y) === DunGen_1.ETiles.WALL;
                var solidRight = x === dungeon.width - 1 || dungeon.tiles.get(x + 1, y) === DunGen_1.ETiles.WALL;
                if (solidTop && solidBottom && solidLeft && solidRight) {
                    var solidTopLeft = y === 0 || x === 0 || dungeon.tiles.get(x - 1, y - 1) === DunGen_1.ETiles.WALL;
                    var solidTopRight = y === 0 || x === dungeon.width - 1 || dungeon.tiles.get(x + 1, y - 1) === DunGen_1.ETiles.WALL;
                    var solidBottomLeft = y === dungeon.height - 1 || x === 0 || dungeon.tiles.get(x - 1, y + 1) === DunGen_1.ETiles.WALL;
                    var solidBottomRight = y === dungeon.height - 1 || x === dungeon.width - 1 || dungeon.tiles.get(x + 1, y + 1) === DunGen_1.ETiles.WALL;
                    if (!solidTopLeft) {
                        texX = 3;
                        texY = 1;
                    }
                    else if (!solidTopRight) {
                        texX = 4;
                        texY = 1;
                    }
                    else if (!solidBottomLeft) {
                        texX = 3;
                        texY = 2;
                    }
                    else if (!solidBottomRight) {
                        texX = 4;
                        texY = 2;
                    }
                    else {
                        texX = 1;
                        texY = 1;
                    }
                }
                else if (!solidLeft && solidRight && solidBottom && !solidTop) {
                    texX = 0;
                    texY = 0;
                }
                else if (solidLeft && solidRight && solidBottom && !solidTop) {
                    texX = 1;
                    texY = 0;
                }
                else if (solidLeft && !solidRight && solidBottom && !solidTop) {
                    texX = 2;
                    texY = 0;
                }
                else if (!solidLeft && solidRight && solidBottom && solidTop) {
                    texX = 0;
                    texY = 1;
                }
                else if (solidLeft && !solidRight && solidBottom && solidTop) {
                    texX = 2;
                    texY = 1;
                }
                else if (!solidLeft && solidRight && !solidBottom && solidTop) {
                    texX = 0;
                    texY = 2;
                }
                else if (solidLeft && solidRight && !solidBottom && solidTop) {
                    texX = 1;
                    texY = 2;
                }
                else if (solidLeft && !solidRight && !solidBottom && solidTop) {
                    texX = 2;
                    texY = 2;
                }
                else if (!solidLeft && solidRight && !solidBottom && !solidTop) {
                    texX = 3;
                    texY = 0;
                }
                else if (solidLeft && solidRight && !solidBottom && !solidTop) {
                    texX = 4;
                    texY = 0;
                }
                else if (solidLeft && !solidRight && !solidBottom && !solidTop) {
                    texX = 5;
                    texY = 0;
                }
                else if (!solidLeft && !solidRight && solidBottom && !solidTop) {
                    texX = 6;
                    texY = 0;
                }
                else if (!solidLeft && !solidRight && solidBottom && solidTop) {
                    texX = 6;
                    texY = 1;
                }
                else if (!solidLeft && !solidRight && !solidBottom && solidTop) {
                    texX = 6;
                    texY = 2;
                }
            }
            return new PIXI.Sprite(new PIXI.Texture(ClassicTileProvider_1.textureSheet.baseTexture, new PIXI.Rectangle(texX * 32, texY * 32, 32, 32)));
        };
        ClassicTileProvider = ClassicTileProvider_1 = __decorate([
            Decorator_1.staticImplements()
        ], ClassicTileProvider);
        return ClassicTileProvider;
        var ClassicTileProvider_1;
    }());
    exports.ClassicTileProvider = ClassicTileProvider;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2xhc3NpY1RpbGVQcm92aWRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wcm92aWRlcnMvQ2xhc3NpY1RpbGVQcm92aWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7SUFLQTtRQUFBO1FBMkdBLENBQUM7Z0NBM0dZLG1CQUFtQjtRQUlkLHlCQUFLLEdBQW5CO1lBQUEsaUJBY0M7WUFiRyxJQUFJLENBQUMsR0FBRyxJQUFJLE9BQU8sQ0FBUSxVQUFDLE9BQU8sRUFBRSxNQUFNO2dCQUN2QyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO29CQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztvQkFDOUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztvQkFDbkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO3dCQUN6QixLQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQzt3QkFDM0QsT0FBTyxFQUFFLENBQUM7b0JBQ2QsQ0FBQyxDQUFFLENBQUM7Z0JBQ1IsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDSixPQUFPLEVBQUUsQ0FBQztnQkFDZCxDQUFDO1lBQ0wsQ0FBQyxDQUFFLENBQUM7WUFDSixNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ2IsQ0FBQztRQUVhLDJCQUFPLEdBQXJCO1lBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEtBQUssU0FBUyxDQUFDO1FBQzNDLENBQUM7UUFFYSwyQkFBTyxHQUFyQixVQUFzQixPQUFnQixFQUFFLENBQVMsRUFBRSxDQUFTO1lBQ3hELElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQztZQUNiLElBQUksSUFBSSxHQUFHLENB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QUMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxxQkFBbUIsQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsRUFBRSxFQUFFLElBQUksR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3SSxDQUFDO1FBekdRLG1CQUFtQjtZQUQvQiw0QkFBZ0IsRUFBaUI7V0FDckIsbUJBQW1CLENBMkcvQjtRQUFELDBCQUFDOztLQUFBLEFBM0dELElBMkdDO0lBM0dZLGtEQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IER1bmdlb24sIEVUaWxlcyB9IGZyb20gXCIuLi9tYXAvRHVuR2VuXCI7XHJcbmltcG9ydCB7IElUaWxlUHJvdmlkZXIgfSBmcm9tIFwiLi9JVGlsZVByb3ZpZGVyXCI7XHJcbmltcG9ydCB7IHN0YXRpY0ltcGxlbWVudHMgfSBmcm9tIFwiLi9EZWNvcmF0b3JcIjtcclxuXHJcbkBzdGF0aWNJbXBsZW1lbnRzPElUaWxlUHJvdmlkZXI+KClcclxuZXhwb3J0IGNsYXNzIENsYXNzaWNUaWxlUHJvdmlkZXIge1xyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgdGV4dHVyZVNoZWV0OiBQSVhJLlRleHR1cmU7XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyByZWFkeSgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICBsZXQgcCA9IG5ldyBQcm9taXNlPHZvaWQ+KCAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy50ZXh0dXJlU2hlZXQpIHtcclxuICAgICAgICAgICAgICAgIFBJWEkubG9hZGVyLmFkZChcInRpbGVzXCIsIFwiaW1nL3RpbGVzXzAwMS5wbmdcIik7XHJcbiAgICAgICAgICAgICAgICBQSVhJLmxvYWRlci5sb2FkKCk7XHJcbiAgICAgICAgICAgICAgICBQSVhJLmxvYWRlci5vbmNlKFwiY29tcGxldGVcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dHVyZVNoZWV0ID0gUElYSS5sb2FkZXIucmVzb3VyY2VzW1widGlsZXNcIl0udGV4dHVyZTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICB9ICk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ICk7XHJcbiAgICAgICAgcmV0dXJuIHA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBpc1JlYWR5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRleHR1cmVTaGVldCAhPT0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0VGlsZShkdW5nZW9uOiBEdW5nZW9uLCB4OiBudW1iZXIsIHk6IG51bWJlcikge1xyXG4gICAgICAgIGxldCB0ZXhYID0gMDtcclxuICAgICAgICBsZXQgdGV4WSA9IDA7XHJcbiAgICAgICAgbGV0IHRpbGUgPSBkdW5nZW9uLnRpbGVzLmdldCh4LCB5KTtcclxuICAgICAgICBpZiAodGlsZSA9PT0gRVRpbGVzLkVNUFRZKSB7XHJcbiAgICAgICAgICAgIHRleFggPSA1O1xyXG4gICAgICAgICAgICB0ZXhZID0gMTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRpbGUgPT09IEVUaWxlcy5MQURERVIpIHtcclxuICAgICAgICAgICAgdGV4WCA9IDU7XHJcbiAgICAgICAgICAgIHRleFkgPSAyO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGlsZSA9PT0gRVRpbGVzLldBTEwpIHtcclxuICAgICAgICAgICAgbGV0IHNvbGlkVG9wID0geSA9PT0gMCB8fCBkdW5nZW9uLnRpbGVzLmdldCh4LCB5IC0gMSkgPT09IEVUaWxlcy5XQUxMO1xyXG4gICAgICAgICAgICBsZXQgc29saWRCb3R0b20gPSB5ID09PSBkdW5nZW9uLmhlaWdodCAtIDEgfHwgZHVuZ2Vvbi50aWxlcy5nZXQoeCwgeSArIDEpID09PSBFVGlsZXMuV0FMTDtcclxuICAgICAgICAgICAgbGV0IHNvbGlkTGVmdCA9IHggPT09IDAgfHwgZHVuZ2Vvbi50aWxlcy5nZXQoeCAtIDEsIHkpID09PSBFVGlsZXMuV0FMTDtcclxuICAgICAgICAgICAgbGV0IHNvbGlkUmlnaHQgPSB4ID09PSBkdW5nZW9uLndpZHRoIC0gMSB8fCBkdW5nZW9uLnRpbGVzLmdldCh4ICsgMSwgeSkgPT09IEVUaWxlcy5XQUxMO1xyXG4gICAgICAgICAgICBpZiAoc29saWRUb3AgJiYgc29saWRCb3R0b20gJiYgc29saWRMZWZ0ICYmIHNvbGlkUmlnaHQpIHtcclxuICAgICAgICAgICAgICAgIGxldCBzb2xpZFRvcExlZnQgPSB5ID09PSAwIHx8IHggPT09IDAgfHwgZHVuZ2Vvbi50aWxlcy5nZXQoeCAtIDEsIHkgLSAxKSA9PT0gRVRpbGVzLldBTEw7XHJcbiAgICAgICAgICAgICAgICBsZXQgc29saWRUb3BSaWdodCA9IHkgPT09IDAgfHwgeCA9PT0gZHVuZ2Vvbi53aWR0aCAtIDEgfHwgZHVuZ2Vvbi50aWxlcy5nZXQoeCArIDEsIHkgLSAxKSA9PT0gRVRpbGVzLldBTEw7XHJcbiAgICAgICAgICAgICAgICBsZXQgc29saWRCb3R0b21MZWZ0ID0geSA9PT0gZHVuZ2Vvbi5oZWlnaHQgLSAxIHx8IHggPT09IDAgfHwgZHVuZ2Vvbi50aWxlcy5nZXQoeCAtIDEsIHkgKyAxKSA9PT0gRVRpbGVzLldBTEw7XHJcbiAgICAgICAgICAgICAgICBsZXQgc29saWRCb3R0b21SaWdodCA9IHkgPT09IGR1bmdlb24uaGVpZ2h0IC0gMSB8fCB4ID09PSBkdW5nZW9uLndpZHRoIC0gMSB8fCBkdW5nZW9uLnRpbGVzLmdldCh4ICsgMSwgeSArIDEpID09PSBFVGlsZXMuV0FMTDtcclxuICAgICAgICAgICAgICAgIGlmICghc29saWRUb3BMZWZ0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4WCA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4WSA9IDE7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFzb2xpZFRvcFJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4WCA9IDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4WSA9IDE7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFzb2xpZEJvdHRvbUxlZnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXhYID0gMztcclxuICAgICAgICAgICAgICAgICAgICB0ZXhZID0gMjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXNvbGlkQm90dG9tUmlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXhYID0gNDtcclxuICAgICAgICAgICAgICAgICAgICB0ZXhZID0gMjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4WCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4WSA9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXNvbGlkTGVmdCAmJiBzb2xpZFJpZ2h0ICYmIHNvbGlkQm90dG9tICYmICFzb2xpZFRvcCkge1xyXG4gICAgICAgICAgICAgICAgdGV4WCA9IDA7XHJcbiAgICAgICAgICAgICAgICB0ZXhZID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChzb2xpZExlZnQgJiYgc29saWRSaWdodCAmJiBzb2xpZEJvdHRvbSAmJiAhc29saWRUb3ApIHtcclxuICAgICAgICAgICAgICAgIHRleFggPSAxO1xyXG4gICAgICAgICAgICAgICAgdGV4WSA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc29saWRMZWZ0ICYmICFzb2xpZFJpZ2h0ICYmIHNvbGlkQm90dG9tICYmICFzb2xpZFRvcCkge1xyXG4gICAgICAgICAgICAgICAgdGV4WCA9IDI7XHJcbiAgICAgICAgICAgICAgICB0ZXhZID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghc29saWRMZWZ0ICYmIHNvbGlkUmlnaHQgJiYgc29saWRCb3R0b20gJiYgc29saWRUb3ApIHtcclxuICAgICAgICAgICAgICAgIHRleFggPSAwO1xyXG4gICAgICAgICAgICAgICAgdGV4WSA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc29saWRMZWZ0ICYmICFzb2xpZFJpZ2h0ICYmIHNvbGlkQm90dG9tICYmIHNvbGlkVG9wKSB7XHJcbiAgICAgICAgICAgICAgICB0ZXhYID0gMjtcclxuICAgICAgICAgICAgICAgIHRleFkgPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFzb2xpZExlZnQgJiYgc29saWRSaWdodCAmJiAhc29saWRCb3R0b20gJiYgc29saWRUb3ApIHtcclxuICAgICAgICAgICAgICAgIHRleFggPSAwO1xyXG4gICAgICAgICAgICAgICAgdGV4WSA9IDI7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc29saWRMZWZ0ICYmIHNvbGlkUmlnaHQgJiYgIXNvbGlkQm90dG9tICYmIHNvbGlkVG9wKSB7XHJcbiAgICAgICAgICAgICAgICB0ZXhYID0gMTtcclxuICAgICAgICAgICAgICAgIHRleFkgPSAyO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNvbGlkTGVmdCAmJiAhc29saWRSaWdodCAmJiAhc29saWRCb3R0b20gJiYgc29saWRUb3ApIHtcclxuICAgICAgICAgICAgICAgIHRleFggPSAyO1xyXG4gICAgICAgICAgICAgICAgdGV4WSA9IDI7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXNvbGlkTGVmdCAmJiBzb2xpZFJpZ2h0ICYmICFzb2xpZEJvdHRvbSAmJiAhc29saWRUb3ApIHtcclxuICAgICAgICAgICAgICAgIHRleFggPSAzO1xyXG4gICAgICAgICAgICAgICAgdGV4WSA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc29saWRMZWZ0ICYmIHNvbGlkUmlnaHQgJiYgIXNvbGlkQm90dG9tICYmICFzb2xpZFRvcCkge1xyXG4gICAgICAgICAgICAgICAgdGV4WCA9IDQ7XHJcbiAgICAgICAgICAgICAgICB0ZXhZID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChzb2xpZExlZnQgJiYgIXNvbGlkUmlnaHQgJiYgIXNvbGlkQm90dG9tICYmICFzb2xpZFRvcCkge1xyXG4gICAgICAgICAgICAgICAgdGV4WCA9IDU7XHJcbiAgICAgICAgICAgICAgICB0ZXhZID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghc29saWRMZWZ0ICYmICFzb2xpZFJpZ2h0ICYmIHNvbGlkQm90dG9tICYmICFzb2xpZFRvcCkge1xyXG4gICAgICAgICAgICAgICAgdGV4WCA9IDY7XHJcbiAgICAgICAgICAgICAgICB0ZXhZID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghc29saWRMZWZ0ICYmICFzb2xpZFJpZ2h0ICYmIHNvbGlkQm90dG9tICYmIHNvbGlkVG9wKSB7XHJcbiAgICAgICAgICAgICAgICB0ZXhYID0gNjtcclxuICAgICAgICAgICAgICAgIHRleFkgPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFzb2xpZExlZnQgJiYgIXNvbGlkUmlnaHQgJiYgIXNvbGlkQm90dG9tICYmIHNvbGlkVG9wKSB7XHJcbiAgICAgICAgICAgICAgICB0ZXhYID0gNjtcclxuICAgICAgICAgICAgICAgIHRleFkgPSAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgUElYSS5TcHJpdGUobmV3IFBJWEkuVGV4dHVyZShDbGFzc2ljVGlsZVByb3ZpZGVyLnRleHR1cmVTaGVldC5iYXNlVGV4dHVyZSwgbmV3IFBJWEkuUmVjdGFuZ2xlKHRleFggKiAzMiwgdGV4WSAqIDMyLCAzMiwgMzIpKSk7XHJcbiAgICB9XHJcblxyXG59Il19