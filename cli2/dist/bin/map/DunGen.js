var __values = (this && this.__values) || function (o) {
    var m = typeof Symbol === "function" && o[Symbol.iterator], i = 0;
    if (m) return m.call(o);
    return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
};
define(["require", "exports", "./Map2D", "./TemplateRoom"], function (require, exports, Map2D_1, TemplateRoom_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var defaults = {
        width: 50,
        height: 50,
    };
    var ETiles;
    (function (ETiles) {
        ETiles[ETiles["SOLID"] = -1] = "SOLID";
        ETiles[ETiles["EMPTY"] = 0] = "EMPTY";
        ETiles[ETiles["WALL"] = 1] = "WALL";
        ETiles[ETiles["TOP_DOOR"] = 2] = "TOP_DOOR";
        ETiles[ETiles["BOTTOM_DOOR"] = 3] = "BOTTOM_DOOR";
        ETiles[ETiles["LEFT_DOOR"] = 4] = "LEFT_DOOR";
        ETiles[ETiles["RIGHT_DOOR"] = 5] = "RIGHT_DOOR";
        ETiles[ETiles["LADDER"] = 6] = "LADDER";
    })(ETiles = exports.ETiles || (exports.ETiles = {}));
    function oppositeDirection(dir) {
        switch (dir) {
            case TemplateRoom_1.Direction.TOP: return TemplateRoom_1.Direction.BOTTOM;
            case TemplateRoom_1.Direction.BOTTOM: return TemplateRoom_1.Direction.TOP;
            case TemplateRoom_1.Direction.LEFT: return TemplateRoom_1.Direction.RIGHT;
            case TemplateRoom_1.Direction.RIGHT: return TemplateRoom_1.Direction.LEFT;
        }
    }
    var directions = [TemplateRoom_1.Direction.TOP, TemplateRoom_1.Direction.BOTTOM, TemplateRoom_1.Direction.LEFT, TemplateRoom_1.Direction.RIGHT];
    function addOpenDoor(x, y, room, direction, openDoors) {
        if (room.doorways[direction] < 0)
            return;
        if (direction === TemplateRoom_1.Direction.TOP) {
            openDoors.push({ direction: direction, x: x + room.doorways[direction], y: y });
        }
        else if (direction === TemplateRoom_1.Direction.BOTTOM) {
            openDoors.push({ direction: direction, x: x + room.doorways[direction], y: y + room.height - 1 });
        }
        else if (direction === TemplateRoom_1.Direction.LEFT) {
            openDoors.push({ direction: direction, x: x, y: y + room.doorways[direction] });
        }
        else if (direction === TemplateRoom_1.Direction.RIGHT) {
            openDoors.push({ direction: direction, x: x + room.width - 1, y: y + room.doorways[direction] });
        }
    }
    function addOpenDoors(x, y, room, openDoors, exculde) {
        if (exculde === void 0) { exculde = []; }
        try {
            for (var directions_1 = __values(directions), directions_1_1 = directions_1.next(); !directions_1_1.done; directions_1_1 = directions_1.next()) {
                var dir = directions_1_1.value;
                if (exculde.indexOf(dir) >= 0 || room.doorways[dir] < 0)
                    continue;
                addOpenDoor(x, y, room, dir, openDoors);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (directions_1_1 && !directions_1_1.done && (_a = directions_1.return)) _a.call(directions_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        var e_1, _a;
    }
    function roomCanAttach(direction, candidateRoom) {
        return candidateRoom.doorways[oppositeDirection(direction)] >= 0;
    }
    function connectedRoomXY(door, room) {
        var connectingDoor = room.doorways[oppositeDirection(door.direction)];
        switch (door.direction) {
            case TemplateRoom_1.Direction.TOP: return { x: door.x - connectingDoor, y: door.y - room.height };
            case TemplateRoom_1.Direction.BOTTOM: return { x: door.x - connectingDoor, y: door.y + 1 };
            case TemplateRoom_1.Direction.LEFT: return { x: door.x - room.width, y: door.y - connectingDoor };
            case TemplateRoom_1.Direction.RIGHT: return { x: door.x + 1, y: door.y - connectingDoor };
            default: throw new Error("Invalid direction");
        }
    }
    function DunGen(templates, opts) {
        opts = opts || {};
        try {
            for (var _a = __values(Keys(defaults)), _b = _a.next(); !_b.done; _b = _a.next()) {
                var key = _b.value;
                if (opts[key] === undefined)
                    opts[key] = defaults[key];
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_b && !_b.done && (_c = _a.return)) _c.call(_a);
            }
            finally { if (e_2) throw e_2.error; }
        }
        var dungeon = new Dungeon(opts.width, opts.height);
        var openDoors = [];
        templates = fyShuffle(templates);
        var root = templates[0];
        var x = Math.floor((dungeon.width - root.width) / 2);
        var y = Math.floor((dungeon.height - root.height) / 2);
        if (!dungeon.paint(root, x, y)) {
            return dungeon;
        }
        addOpenDoors(x, y, root, openDoors);
        while (openDoors.length) {
            openDoors = fyShuffle(openDoors);
            var door = openDoors.pop();
            templates = fyShuffle(templates);
            try {
                for (var templates_1 = __values(templates), templates_1_1 = templates_1.next(); !templates_1_1.done; templates_1_1 = templates_1.next()) {
                    var candidate = templates_1_1.value;
                    if (!roomCanAttach(door.direction, candidate))
                        continue;
                    var xy = connectedRoomXY(door, candidate);
                    if (dungeon.paint(candidate, xy.x, xy.y)) {
                        addOpenDoors(xy.x, xy.y, candidate, openDoors, [oppositeDirection(door.direction)]);
                    }
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (templates_1_1 && !templates_1_1.done && (_d = templates_1.return)) _d.call(templates_1);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
        dungeon = dungeon.map(function (tile, x, y, dungeon) {
            if (tile === ETiles.SOLID || tile === ETiles.WALL) {
                if (y > 0 && y < dungeon.height - 1) {
                    var top_1 = dungeon.tiles.get(x, y - 1);
                    var bottom = dungeon.tiles.get(x, y + 1);
                    if (((top_1 === TemplateRoom_1.Direction.BOTTOM || top_1 === 0) && (bottom === TemplateRoom_1.Direction.TOP || bottom === 0))
                        && top_1 !== bottom) {
                        return TemplateRoom_1.Direction.BOTTOM;
                    }
                }
                if (x > 0 && x < dungeon.width - 1) {
                    var left = dungeon.tiles.get(x - 1, y);
                    var right = dungeon.tiles.get(x + 1, y);
                    if (((left === TemplateRoom_1.Direction.RIGHT || left === 0) && (right === TemplateRoom_1.Direction.LEFT || right === 0))
                        && left !== right) {
                        return 0;
                    }
                }
            }
            if (directions.indexOf(tile) < 0)
                return tile;
            if (x > 0 && x < dungeon.width - 1 && y > 0 && y < dungeon.height - 1) {
                var xy = { x: 0, y: 0 };
                switch (tile) {
                    case TemplateRoom_1.Direction.TOP:
                        xy.y = -1;
                        break;
                    case TemplateRoom_1.Direction.BOTTOM:
                        xy.y = 1;
                        break;
                    case TemplateRoom_1.Direction.LEFT:
                        xy.x = -1;
                        break;
                    case TemplateRoom_1.Direction.RIGHT:
                        xy.x = 1;
                        break;
                }
                if (dungeon.tiles.get(x + xy.x, y + xy.y) === oppositeDirection(tile)) {
                    return tile === TemplateRoom_1.Direction.BOTTOM ? TemplateRoom_1.Direction.BOTTOM : ETiles.EMPTY;
                }
                else {
                    if (x > 1 && x < dungeon.width - 2 && y > 1 && y < dungeon.height - 2) {
                        var reach = dungeon.tiles.get(x + xy.x * 2, y + xy.y * 2);
                        if (reach === ETiles.EMPTY || reach === oppositeDirection(tile)) {
                            return tile === TemplateRoom_1.Direction.BOTTOM ? TemplateRoom_1.Direction.BOTTOM : ETiles.EMPTY;
                        }
                    }
                }
            }
            return ETiles.WALL;
        });
        var ladderSeeds = [];
        for (var i = 0; i < dungeon.width - 1; i++) {
            for (var j = 0; j < dungeon.width - 1; j++) {
                if (dungeon.tiles.get(i, j) === ETiles.EMPTY && dungeon.tiles.get(i + 1, j) === ETiles.EMPTY) {
                    var bl = dungeon.tiles.get(i, j + 1);
                    var br = dungeon.tiles.get(i + 1, j + 1);
                    if (bl === 1 && br === TemplateRoom_1.Direction.BOTTOM) {
                        ladderSeeds.push({ x: i + 1, y: j + 1 });
                    }
                    else if (bl === TemplateRoom_1.Direction.BOTTOM && br === ETiles.WALL) {
                        ladderSeeds.push({ x: i, y: j + 1 });
                    }
                }
            }
        }
        ladderSeeds = fyShuffle(ladderSeeds);
        function eraseBottomDoor(x, y) {
            if (dungeon.tiles.get(x, y) === TemplateRoom_1.Direction.BOTTOM) {
                dungeon.tiles.set(x, y, ETiles.EMPTY);
                eraseBottomDoor(x - 1, y);
                eraseBottomDoor(x + 1, y);
            }
        }
        while (ladderSeeds.length > 0) {
            var seed = ladderSeeds.pop();
            if (dungeon.tiles.get(seed.x, seed.y) !== TemplateRoom_1.Direction.BOTTOM)
                continue;
            while (dungeon.tiles.get(seed.x, seed.y) !== ETiles.WALL) {
                if (dungeon.tiles.get(seed.x, seed.y) === TemplateRoom_1.Direction.BOTTOM) {
                    eraseBottomDoor(seed.x, seed.y);
                }
                dungeon.tiles.set(seed.x, seed.y, ETiles.LADDER);
                seed.y++;
            }
        }
        return dungeon.map(function (t) { return t === ETiles.SOLID ? ETiles.WALL : t; });
        var e_2, _c, e_3, _d;
    }
    exports.DunGen = DunGen;
    var Dungeon = /** @class */ (function () {
        function Dungeon(width, height, initializer) {
            if (initializer === void 0) { initializer = function () { return -1; }; }
            this.width = width;
            this.height = height;
            this.tiles = new Map2D_1.Map2D();
            for (var i = 0; i < width; i++) {
                for (var j = 0; j < height; j++) {
                    this.tiles.set(i, j, initializer(i, j));
                }
            }
        }
        Dungeon.prototype.paint = function (room, x, y) {
            if (x < 0 || y < 0 || x + room.width > this.width || y + room.height > this.height)
                return false;
            for (var i = 0; i < room.width; i++) {
                for (var j = 0; j < room.height; j++) {
                    var tile = this.tiles.get(x + i, y + j);
                    if (tile === undefined || tile !== ETiles.SOLID)
                        return false;
                }
            }
            for (var i = 0; i < room.width; i++) {
                for (var j = 0; j < room.height; j++) {
                    this.tiles.set(x + i, y + j, room.tiles.get(i, j));
                }
            }
            return true;
        };
        Dungeon.prototype.map = function (fn) {
            var _this = this;
            return new Dungeon(this.width, this.height, function (x, y) {
                return fn(_this.tiles.get(x, y), x, y, _this);
            });
        };
        return Dungeon;
    }());
    exports.Dungeon = Dungeon;
    function fyShuffle(arr) {
        arr = arr.slice();
        for (var i = arr.length - 1; i > 0; i--) {
            var swp = Math.floor(Math.random() * (i + 1));
            var temp = arr[i];
            arr[i] = arr[swp];
            arr[swp] = temp;
        }
        return arr;
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHVuR2VuLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21hcC9EdW5HZW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztJQVFBLElBQUksUUFBUSxHQUFlO1FBQ3ZCLEtBQUssRUFBRSxFQUFFO1FBQ1QsTUFBTSxFQUFFLEVBQUU7S0FDYixDQUFBO0lBV0QsSUFBWSxNQVNYO0lBVEQsV0FBWSxNQUFNO1FBQ2Qsc0NBQVUsQ0FBQTtRQUNWLHFDQUFTLENBQUE7UUFDVCxtQ0FBUSxDQUFBO1FBQ1IsMkNBQXdCLENBQUE7UUFDeEIsaURBQThCLENBQUE7UUFDOUIsNkNBQTBCLENBQUE7UUFDMUIsK0NBQTRCLENBQUE7UUFDNUIsdUNBQVUsQ0FBQTtJQUNkLENBQUMsRUFUVyxNQUFNLEdBQU4sY0FBTSxLQUFOLGNBQU0sUUFTakI7SUFFRCwyQkFBMkIsR0FBYztRQUNyQyxNQUFNLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ1QsS0FBSyx3QkFBUyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsd0JBQVMsQ0FBQyxNQUFNLENBQUM7WUFDNUMsS0FBSyx3QkFBUyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsd0JBQVMsQ0FBQyxHQUFHLENBQUM7WUFDNUMsS0FBSyx3QkFBUyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsd0JBQVMsQ0FBQyxLQUFLLENBQUM7WUFDNUMsS0FBSyx3QkFBUyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsd0JBQVMsQ0FBQyxJQUFJLENBQUM7UUFDaEQsQ0FBQztJQUNMLENBQUM7SUFFRCxJQUFNLFVBQVUsR0FBRyxDQUFDLHdCQUFTLENBQUMsR0FBRyxFQUFFLHdCQUFTLENBQUMsTUFBTSxFQUFFLHdCQUFTLENBQUMsSUFBSSxFQUFFLHdCQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFdEYscUJBQXFCLENBQVMsRUFBRSxDQUFTLEVBQUUsSUFBa0IsRUFBRSxTQUFvQixFQUFFLFNBQXNCO1FBQ3ZHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBTSxDQUFDO1FBQ3pDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsS0FBSyx3QkFBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDOUIsU0FBUyxDQUFDLElBQUksQ0FBRSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO1FBQ3RGLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxLQUFLLHdCQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN4QyxTQUFTLENBQUMsSUFBSSxDQUFFLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFFLENBQUM7UUFDeEcsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxTQUFTLEtBQUssd0JBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLFNBQVMsQ0FBQyxJQUFJLENBQUUsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUUsQ0FBQztRQUN0RixDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsS0FBSyx3QkFBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDdkMsU0FBUyxDQUFDLElBQUksQ0FBRSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFF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LEtBQUssRUFBRSxDQUFDO1FBQ2xCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFHLEVBQUUsQ0FBQztZQUN2QyxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlDLElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQixHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2xCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDcEIsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUM7SUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWFwMkQgfSBmcm9tIFwiLi9NYXAyRFwiO1xyXG5pbXBvcnQgeyBUZW1wbGF0ZVJvb20sIERpcmVjdGlvbiB9IGZyb20gXCIuL1RlbXBsYXRlUm9vbVwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBEdW5HZW5PcHRzIHtcclxuICAgIHdpZHRoPzogbnVtYmVyLFxyXG4gICAgaGVpZ2h0PzogbnVtYmVyLFxyXG59XHJcblxyXG5sZXQgZGVmYXVsdHM6IER1bkdlbk9wdHMgPSB7XHJcbiAgICB3aWR0aDogNTAsXHJcbiAgICBoZWlnaHQ6IDUwLFxyXG59XHJcblxyXG5pbnRlcmZhY2UgSU9wZW5Eb29yIGV4dGVuZHMgSVBvaW50IHtcclxuICAgIGRpcmVjdGlvbjogRGlyZWN0aW9uO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgSVBvaW50IHtcclxuICAgIHg6IG51bWJlcjtcclxuICAgIHk6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGVudW0gRVRpbGVzIHtcclxuICAgIFNPTElEID0gLTEsXHJcbiAgICBFTVBUWSA9IDAsXHJcbiAgICBXQUxMID0gMSxcclxuICAgIFRPUF9ET09SID0gRGlyZWN0aW9uLlRPUCxcclxuICAgIEJPVFRPTV9ET09SID0gRGlyZWN0aW9uLkJPVFRPTSxcclxuICAgIExFRlRfRE9PUiA9IERpcmVjdGlvbi5MRUZULFxyXG4gICAgUklHSFRfRE9PUiA9IERpcmVjdGlvbi5SSUdIVCxcclxuICAgIExBRERFUiA9IDYsXHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9wcG9zaXRlRGlyZWN0aW9uKGRpcjogRGlyZWN0aW9uKTogRGlyZWN0aW9uIHtcclxuICAgIHN3aXRjaChkaXIpIHtcclxuICAgICAgICBjYXNlIERpcmVjdGlvbi5UT1A6IHJldHVybiBEaXJlY3Rpb24uQk9UVE9NO1xyXG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLkJPVFRPTTogcmV0dXJuIERpcmVjdGlvbi5UT1A7XHJcbiAgICAgICAgY2FzZSBEaXJlY3Rpb24uTEVGVDogcmV0dXJuIERpcmVjdGlvbi5SSUdIVDtcclxuICAgICAgICBjYXNlIERpcmVjdGlvbi5SSUdIVDogcmV0dXJuIERpcmVjdGlvbi5MRUZUO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBkaXJlY3Rpb25zID0gW0RpcmVjdGlvbi5UT1AsIERpcmVjdGlvbi5CT1RUT00sIERpcmVjdGlvbi5MRUZULCBEaXJlY3Rpb24uUklHSFRdO1xyXG5cclxuZnVuY3Rpb24gYWRkT3BlbkRvb3IoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJvb206IFRlbXBsYXRlUm9vbSwgZGlyZWN0aW9uOiBEaXJlY3Rpb24sIG9wZW5Eb29yczogSU9wZW5Eb29yW10pIHtcclxuICAgIGlmIChyb29tLmRvb3J3YXlzW2RpcmVjdGlvbl0gPCAwKSByZXR1cm47XHJcbiAgICBpZiAoZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uVE9QKSB7XHJcbiAgICAgICAgb3BlbkRvb3JzLnB1c2goIHsgZGlyZWN0aW9uOiBkaXJlY3Rpb24sIHg6IHggKyByb29tLmRvb3J3YXlzW2RpcmVjdGlvbl0sIHk6IHkgfSApO1xyXG4gICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5CT1RUT00pIHtcclxuICAgICAgICBvcGVuRG9vcnMucHVzaCggeyBkaXJlY3Rpb246IGRpcmVjdGlvbiwgeDogeCArIHJvb20uZG9vcndheXNbZGlyZWN0aW9uXSwgeTogeSArIHJvb20uaGVpZ2h0IC0gMSB9ICk7XHJcbiAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLkxFRlQpIHtcclxuICAgICAgICBvcGVuRG9vcnMucHVzaCggeyBkaXJlY3Rpb246IGRpcmVjdGlvbiwgeDogeCwgeTogeSArIHJvb20uZG9vcndheXNbZGlyZWN0aW9uXSB9ICk7XHJcbiAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLlJJR0hUKSB7XHJcbiAgICAgICAgb3BlbkRvb3JzLnB1c2goIHsgZGlyZWN0aW9uOiBkaXJlY3Rpb24sIHg6IHggKyByb29tLndpZHRoIC0gMSwgeTogeSArIHJvb20uZG9vcndheXNbZGlyZWN0aW9uXSB9ICk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFkZE9wZW5Eb29ycyh4OiBudW1iZXIsIHk6IG51bWJlciwgcm9vbTogVGVtcGxhdGVSb29tLCBvcGVuRG9vcnM6IElPcGVuRG9vcltdLCBleGN1bGRlOiBEaXJlY3Rpb25bXSA9IFtdKSB7XHJcbiAgICBmb3IgKGxldCBkaXIgb2YgZGlyZWN0aW9ucykge1xyXG4gICAgICAgIGlmIChleGN1bGRlLmluZGV4T2YoZGlyKSA+PSAwIHx8IHJvb20uZG9vcndheXNbZGlyXSA8IDApIGNvbnRpbnVlO1xyXG4gICAgICAgIGFkZE9wZW5Eb29yKHgsIHksIHJvb20sIGRpciwgb3BlbkRvb3JzKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcm9vbUNhbkF0dGFjaChkaXJlY3Rpb246IERpcmVjdGlvbiwgY2FuZGlkYXRlUm9vbTogVGVtcGxhdGVSb29tKSB7XHJcbiAgICByZXR1cm4gY2FuZGlkYXRlUm9vbS5kb29yd2F5c1tvcHBvc2l0ZURpcmVjdGlvbihkaXJlY3Rpb24pXSA+PSAwO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjb25uZWN0ZWRSb29tWFkoZG9vcjogSU9wZW5Eb29yLCByb29tOiBUZW1wbGF0ZVJvb20pIHtcclxuICAgIGxldCBjb25uZWN0aW5nRG9vciA9IHJvb20uZG9vcndheXNbb3Bwb3NpdGVEaXJlY3Rpb24oZG9vci5kaXJlY3Rpb24pXTtcclxuICAgIHN3aXRjaCAoZG9vci5kaXJlY3Rpb24pIHtcclxuICAgICAgICBjYXNlIERpcmVjdGlvbi5UT1A6IHJldHVybiB7IHg6IGRvb3IueCAtIGNvbm5lY3RpbmdEb29yLCB5OiBkb29yLnkgLSByb29tLmhlaWdodCB9O1xyXG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLkJPVFRPTTogcmV0dXJuIHsgeDogZG9vci54IC0gY29ubmVjdGluZ0Rvb3IsIHk6IGRvb3IueSArIDEgfTtcclxuICAgICAgICBjYXNlIERpcmVjdGlvbi5MRUZUOiByZXR1cm4geyB4OiBkb29yLnggLSByb29tLndpZHRoLCB5OiBkb29yLnkgLSBjb25uZWN0aW5nRG9vciB9O1xyXG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLlJJR0hUOiByZXR1cm4geyB4OiBkb29yLnggKyAxLCB5OiBkb29yLnkgLSBjb25uZWN0aW5nRG9vciB9O1xyXG4gICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZGlyZWN0aW9uXCIpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gRHVuR2VuKHRlbXBsYXRlczogVGVtcGxhdGVSb29tW10sIG9wdHM/OiBEdW5HZW5PcHRzKSB7XHJcbiAgICBvcHRzID0gb3B0cyB8fCB7fTtcclxuICAgIGZvciAobGV0IGtleSBvZiBLZXlzKGRlZmF1bHRzKSkge1xyXG4gICAgICAgIGlmIChvcHRzW2tleV0gPT09IHVuZGVmaW5lZCkgb3B0c1trZXldID0gZGVmYXVsdHNba2V5XTtcclxuICAgIH1cclxuICAgIGxldCBkdW5nZW9uID0gbmV3IER1bmdlb24ob3B0cy53aWR0aCEsIG9wdHMuaGVpZ2h0ISk7XHJcbiAgICBsZXQgb3BlbkRvb3JzOiBJT3BlbkRvb3JbXSA9IFtdO1xyXG4gICAgdGVtcGxhdGVzID0gZnlTaHVmZmxlKHRlbXBsYXRlcyk7XHJcbiAgICBsZXQgcm9vdCA9IHRlbXBsYXRlc1swXTtcclxuICAgIGxldCB4ID0gTWF0aC5mbG9vcigoZHVuZ2Vvbi53aWR0aCAtIHJvb3Qud2lkdGgpIC8gMik7XHJcbiAgICBsZXQgeSA9IE1hdGguZmxvb3IoKGR1bmdlb24uaGVpZ2h0IC0gcm9vdC5oZWlnaHQpIC8gMik7XHJcbiAgICBpZiAoIWR1bmdlb24ucGFpbnQocm9vdCwgeCwgeSkpIHtcclxuICAgICAgICByZXR1cm4gZHVuZ2VvbjtcclxuICAgIH1cclxuICAgIGFkZE9wZW5Eb29ycyh4LCB5LCByb290LCBvcGVuRG9vcnMpO1xyXG5cclxuICAgIHdoaWxlIChvcGVuRG9vcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgb3BlbkRvb3JzID0gZnlTaHVmZmxlKG9wZW5Eb29ycyk7XHJcbiAgICAgICAgbGV0IGRvb3IgPSBvcGVuRG9vcnMucG9wKCkhO1xyXG4gICAgICAgIHRlbXBsYXRlcyA9IGZ5U2h1ZmZsZSh0ZW1wbGF0ZXMpO1xyXG4gICAgICAgIGZvciAobGV0IGNhbmRpZGF0ZSBvZiB0ZW1wbGF0ZXMpIHtcclxuICAgICAgICAgICAgaWYgKCFyb29tQ2FuQXR0YWNoKGRvb3IuZGlyZWN0aW9uLCBjYW5kaWRhdGUpKSBjb250aW51ZTtcclxuICAgICAgICAgICAgbGV0IHh5ID0gY29ubmVjdGVkUm9vbVhZKGRvb3IsIGNhbmRpZGF0ZSk7XHJcbiAgICAgICAgICAgIGlmIChkdW5nZW9uLnBhaW50KGNhbmRpZGF0ZSwgeHkueCwgeHkueSkpIHtcclxuICAgICAgICAgICAgICAgIGFkZE9wZW5Eb29ycyh4eS54LCB4eS55LCBjYW5kaWRhdGUsIG9wZW5Eb29ycywgW29wcG9zaXRlRGlyZWN0aW9uKGRvb3IuZGlyZWN0aW9uKV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBkdW5nZW9uID0gZHVuZ2Vvbi5tYXAoICh0aWxlLCB4LCB5LCBkdW5nZW9uKSA9PiB7XHJcbiAgICAgICAgaWYgKHRpbGUgPT09IEVUaWxlcy5TT0xJRCB8fCB0aWxlID09PSBFVGlsZXMuV0FMTCkge1xyXG4gICAgICAgICAgICBpZiAoeSA+IDAgJiYgeSA8IGR1bmdlb24uaGVpZ2h0IC0gMSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHRvcCA9IGR1bmdlb24udGlsZXMuZ2V0KHgsIHkgLSAxKTtcclxuICAgICAgICAgICAgICAgIGxldCBib3R0b20gPSBkdW5nZW9uLnRpbGVzLmdldCh4LCB5ICsgMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoKCh0b3AgPT09IERpcmVjdGlvbi5CT1RUT00gfHwgdG9wID09PSAwKSAmJiAoYm90dG9tID09PSBEaXJlY3Rpb24uVE9QIHx8IGJvdHRvbSA9PT0gMCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiB0b3AgIT09IGJvdHRvbSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRGlyZWN0aW9uLkJPVFRPTTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoeCA+IDAgJiYgeCA8IGR1bmdlb24ud2lkdGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbGVmdCA9IGR1bmdlb24udGlsZXMuZ2V0KHggLSAxLCB5KTtcclxuICAgICAgICAgICAgICAgIGxldCByaWdodCA9IGR1bmdlb24udGlsZXMuZ2V0KHggKyAxLCB5KTtcclxuICAgICAgICAgICAgICAgIGlmICgoKGxlZnQgPT09IERpcmVjdGlvbi5SSUdIVCB8fCBsZWZ0ID09PSAwKSAmJiAocmlnaHQgPT09IERpcmVjdGlvbi5MRUZUIHx8IHJpZ2h0ID09PSAwKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBsZWZ0ICE9PSByaWdodClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGlyZWN0aW9ucy5pbmRleE9mKHRpbGUpIDwgMCkgcmV0dXJuIHRpbGU7XHJcbiAgICAgICAgaWYgKHggPiAwICYmIHggPCBkdW5nZW9uLndpZHRoIC0gMSAmJiB5ID4gMCAmJiB5IDwgZHVuZ2Vvbi5oZWlnaHQgLSAxKSB7XHJcbiAgICAgICAgICAgIGxldCB4eSA9IHsgeDogMCwgeTogMCB9O1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRpbGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLlRPUDogeHkueSA9IC0xOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLkJPVFRPTTogeHkueSA9IDE7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBEaXJlY3Rpb24uTEVGVDogeHkueCA9IC0xOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLlJJR0hUOiB4eS54ID0gMTsgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KHggKyB4eS54LCB5ICsgeHkueSkgPT09IG9wcG9zaXRlRGlyZWN0aW9uKHRpbGUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGlsZSA9PT0gRGlyZWN0aW9uLkJPVFRPTSA/IERpcmVjdGlvbi5CT1RUT00gOiBFVGlsZXMuRU1QVFk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoeCA+IDEgJiYgeCA8IGR1bmdlb24ud2lkdGggLSAyICYmIHkgPiAxICYmIHkgPCBkdW5nZW9uLmhlaWdodCAtIDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcmVhY2ggPSBkdW5nZW9uLnRpbGVzLmdldCh4ICsgeHkueCAqIDIsIHkgKyB4eS55ICogMilcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVhY2ggPT09IEVUaWxlcy5FTVBUWSB8fCByZWFjaCA9PT0gb3Bwb3NpdGVEaXJlY3Rpb24odGlsZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpbGUgPT09IERpcmVjdGlvbi5CT1RUT00gPyBEaXJlY3Rpb24uQk9UVE9NIDogRVRpbGVzLkVNUFRZO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gRVRpbGVzLldBTEw7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgbGV0IGxhZGRlclNlZWRzOiBJUG9pbnRbXSA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkdW5nZW9uLndpZHRoIC0gMTsgaSArKykge1xyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZHVuZ2Vvbi53aWR0aCAtIDE7IGogKyspIHtcclxuICAgICAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KGksIGopID09PSBFVGlsZXMuRU1QVFkgJiYgZHVuZ2Vvbi50aWxlcy5nZXQoaSArIDEsIGopID09PSBFVGlsZXMuRU1QVFkpIHtcclxuICAgICAgICAgICAgICAgIGxldCBibCA9IGR1bmdlb24udGlsZXMuZ2V0KGksIGogKyAxKTtcclxuICAgICAgICAgICAgICAgIGxldCBiciA9IGR1bmdlb24udGlsZXMuZ2V0KGkgKyAxLCBqICsgMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmwgPT09IDEgJiYgYnIgPT09IERpcmVjdGlvbi5CT1RUT00pIHtcclxuICAgICAgICAgICAgICAgICAgICBsYWRkZXJTZWVkcy5wdXNoKHsgeDogaSArIDEsIHk6IGogKyAxIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChibCA9PT0gRGlyZWN0aW9uLkJPVFRPTSAmJiBiciA9PT0gRVRpbGVzLldBTEwpIHtcclxuICAgICAgICAgICAgICAgICAgICBsYWRkZXJTZWVkcy5wdXNoKHsgeDogaSwgeTogaiArIDEgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBsYWRkZXJTZWVkcyA9IGZ5U2h1ZmZsZShsYWRkZXJTZWVkcyk7XHJcblxyXG4gICAgZnVuY3Rpb24gZXJhc2VCb3R0b21Eb29yKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KHgsIHkpID09PSBEaXJlY3Rpb24uQk9UVE9NKSB7XHJcbiAgICAgICAgICAgIGR1bmdlb24udGlsZXMuc2V0KHgsIHksIEVUaWxlcy5FTVBUWSk7XHJcbiAgICAgICAgICAgIGVyYXNlQm90dG9tRG9vcih4IC0gMSwgeSk7XHJcbiAgICAgICAgICAgIGVyYXNlQm90dG9tRG9vcih4ICsgMSwgeSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdoaWxlIChsYWRkZXJTZWVkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgbGV0IHNlZWQgPSBsYWRkZXJTZWVkcy5wb3AoKSE7XHJcbiAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KHNlZWQueCwgc2VlZC55KSAhPT0gRGlyZWN0aW9uLkJPVFRPTSkgY29udGludWU7XHJcbiAgICAgICAgd2hpbGUgKGR1bmdlb24udGlsZXMuZ2V0KHNlZWQueCwgc2VlZC55KSAhPT0gRVRpbGVzLldBTEwpIHtcclxuICAgICAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KHNlZWQueCwgc2VlZC55KSA9PT0gRGlyZWN0aW9uLkJPVFRPTSkge1xyXG4gICAgICAgICAgICAgICAgZXJhc2VCb3R0b21Eb29yKHNlZWQueCwgc2VlZC55KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkdW5nZW9uLnRpbGVzLnNldChzZWVkLngsIHNlZWQueSwgRVRpbGVzLkxBRERFUik7XHJcbiAgICAgICAgICAgIHNlZWQueSArKztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGR1bmdlb24ubWFwKCAodCkgPT4gdCA9PT0gRVRpbGVzLlNPTElEID8gRVRpbGVzLldBTEwgOiB0ICk7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBEdW5nZW9uIHtcclxuICAgIHB1YmxpYyB0aWxlcyA9IG5ldyBNYXAyRDxudW1iZXI+KCk7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgd2lkdGg6IG51bWJlciwgcHVibGljIGhlaWdodDogbnVtYmVyLCBpbml0aWFsaXplcjogKHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiBudW1iZXIgPSAoKSA9PiAtMSkge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2lkdGg7IGkgKyspIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBoZWlnaHQ7IGogKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGlsZXMuc2V0KGksIGosIGluaXRpYWxpemVyKGksIGopKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwYWludChyb29tOiBUZW1wbGF0ZVJvb20sIHg6IG51bWJlciwgeTogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKHggPCAwIHx8IHkgPCAwIHx8IHggKyByb29tLndpZHRoID4gdGhpcy53aWR0aCB8fCB5ICsgcm9vbS5oZWlnaHQgPiB0aGlzLmhlaWdodCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm9vbS53aWR0aDsgaSArKykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHJvb20uaGVpZ2h0OyBqICsrKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGlsZSA9IHRoaXMudGlsZXMuZ2V0KHggKyBpLCB5ICsgaik7XHJcbiAgICAgICAgICAgICAgICBpZiAodGlsZSA9PT0gdW5kZWZpbmVkIHx8IHRpbGUgIT09IEVUaWxlcy5TT0xJRCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm9vbS53aWR0aDsgaSArKykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHJvb20uaGVpZ2h0OyBqICsrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpbGVzLnNldCh4ICsgaSwgeSArIGosIHJvb20udGlsZXMuZ2V0KGksIGopKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBtYXAoZm46ICh0aWxlOiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyLCBkdW5nZW9uOiB0aGlzKSA9PiBudW1iZXIpOiBEdW5nZW9uIHtcclxuICAgICAgICByZXR1cm4gbmV3IER1bmdlb24odGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsICh4LCB5KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBmbih0aGlzLnRpbGVzLmdldCh4LCB5KSwgeCwgeSwgdGhpcyk7XHJcbiAgICAgICAgfSApO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBmeVNodWZmbGU8VD4oYXJyOiBUW10pOiBUW10ge1xyXG4gICAgYXJyID0gYXJyLnNsaWNlKCk7XHJcbiAgICBmb3IgKGxldCBpID0gYXJyLmxlbmd0aCAtIDE7IGkgPiAwOyBpIC0tKSB7XHJcbiAgICAgICAgbGV0IHN3cCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpO1xyXG4gICAgICAgIGxldCB0ZW1wID0gYXJyW2ldO1xyXG4gICAgICAgIGFycltpXSA9IGFycltzd3BdO1xyXG4gICAgICAgIGFycltzd3BdID0gdGVtcDtcclxuICAgIH1cclxuICAgIHJldHVybiBhcnI7XHJcbn0iXX0=