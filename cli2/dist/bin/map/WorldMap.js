var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
define(["require", "exports", "./DunGen", "../root"], function (require, exports, DunGen_1, root_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.TILE_SIZE = 32;
    var EPSILON = 0.001;
    var WorldMap = /** @class */ (function (_super) {
        __extends(WorldMap, _super);
        function WorldMap(world, dungeon, provider) {
            var _this = _super.call(this) || this;
            _this.world = world;
            _this.dungeon = dungeon;
            _this.provider = provider;
            if (!provider.isReady())
                throw new Error("Provider is not ready");
            var tex = PIXI.RenderTexture.create(dungeon.width * exports.TILE_SIZE, dungeon.height * exports.TILE_SIZE);
            var container = new PIXI.Container();
            for (var i = 0; i < dungeon.width; i++) {
                for (var j = 0; j < dungeon.height; j++) {
                    var tile = provider.getTile(dungeon, i, j);
                    tile.x = i * exports.TILE_SIZE;
                    tile.y = j * exports.TILE_SIZE;
                    container.addChild(tile);
                    // tile.destroy();
                }
            }
            root_1.root.app.renderer.render(container, tex);
            container.destroy();
            _this.addChild(new PIXI.Sprite(tex));
            return _this;
        }
        WorldMap.prototype.move = function (actor) {
            var collisions = [0, 0];
            var xv = actor.velocity.x;
            while (xv !== 0) {
                var move = Math.max(Math.min(exports.TILE_SIZE, xv), -exports.TILE_SIZE);
                actor.x += move;
                xv -= move;
                var left = Math.floor(actor.left / exports.TILE_SIZE);
                var right = Math.floor(actor.right / exports.TILE_SIZE);
                var top_1 = Math.floor(actor.top / exports.TILE_SIZE);
                var bottom = Math.floor(actor.bottom / exports.TILE_SIZE);
                for (var i = top_1; i <= bottom; i++) {
                    if (this.dungeon.tiles.get(left, i) === DunGen_1.ETiles.WALL || this.dungeon.tiles.get(right, i) === DunGen_1.ETiles.WALL) {
                        if (move > 0) {
                            actor.right = right * 32 - EPSILON;
                            collisions[0] = 1;
                        }
                        else {
                            actor.left = left * 32 + 32 + EPSILON;
                            collisions[0] = -1;
                        }
                        xv = 0;
                        actor.velocity.x = 0;
                        break;
                    }
                }
            }
            var yv = actor.velocity.y;
            while (yv !== 0) {
                var move = Math.max(Math.min(exports.TILE_SIZE, yv), -exports.TILE_SIZE);
                actor.y += move;
                yv -= move;
                var left = Math.floor(actor.left / exports.TILE_SIZE);
                var right = Math.floor(actor.right / exports.TILE_SIZE);
                var top_2 = Math.floor(actor.top / exports.TILE_SIZE);
                var bottom = Math.floor(actor.bottom / exports.TILE_SIZE);
                for (var i = left; i <= right; i++) {
                    if (this.dungeon.tiles.get(i, top_2) === DunGen_1.ETiles.WALL || this.dungeon.tiles.get(i, bottom) === DunGen_1.ETiles.WALL) {
                        if (move > 0) {
                            actor.bottom = bottom * 32 - EPSILON;
                            collisions[1] = 1;
                        }
                        else {
                            actor.top = top_2 * 32 + 32 + EPSILON;
                            collisions[1] = -1;
                        }
                        yv = 0;
                        actor.velocity.y = 0;
                        break;
                    }
                }
            }
            return collisions;
        };
        WorldMap.prototype.isOnLadder = function (actor) {
            var center = Math.floor(actor.horizontalCenter / exports.TILE_SIZE);
            var top = Math.floor(actor.top / exports.TILE_SIZE);
            var bottom = Math.floor(actor.bottom / exports.TILE_SIZE);
            return (this.dungeon.tiles.get(center, top) === DunGen_1.ETiles.LADDER || this.dungeon.tiles.get(center, bottom) === DunGen_1.ETiles.LADDER);
        };
        return WorldMap;
    }(PIXI.Container));
    exports.WorldMap = WorldMap;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV29ybGRNYXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbWFwL1dvcmxkTWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7SUFNYSxRQUFBLFNBQVMsR0FBRyxFQUFFLENBQUM7SUFDNUIsSUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDO0lBRXRCO1FBQThCLDRCQUFjO1FBRXhDLGtCQUFtQixLQUFZLEVBQVMsT0FBZ0IsRUFBUyxRQUF1QjtZQUF4RixZQUNJLGlCQUFPLFNBZ0JWO1lBakJrQixXQUFLLEdBQUwsS0FBSyxDQUFPO1lBQVMsYUFBTyxHQUFQLE9BQU8sQ0FBUztZQUFTLGNBQVEsR0FBUixRQUFRLENBQWU7WUFFcEYsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1lBQ2xFLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsaUJBQVMsRUFBRSxPQUFPLENBQUMsTUFBTSxHQUFHLGlCQUFTLENBQUMsQ0FBQztZQUMzRixJQUFJLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNyQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFHLEVBQUUsQ0FBQztnQkFDdEMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxFQUFFLENBQUM7b0JBQ3ZDLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztvQkFDM0MsSUFBSSxDQUFDLENB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VGlsZXMgfSBmcm9tIFwiLi9EdW5HZW5cIjtcclxuaW1wb3J0IHsgV29ybGQgfSBmcm9tIFwiLi4vV29ybGRcIjtcclxuaW1wb3J0IHsgSVRpbGVQcm92aWRlciB9IGZyb20gXCIuLi9wcm92aWRlcnMvSVRpbGVQcm92aWRlclwiO1xyXG5pbXBvcnQgeyBBY3RvciB9IGZyb20gXCIuLi9hY3RvcnMvQWN0b3JcIjtcclxuaW1wb3J0IHsgcm9vdCB9IGZyb20gXCIuLi9yb290XCI7XHJcblxyXG5leHBvcnQgY29uc3QgVElMRV9TSVpFID0gMzI7XHJcbmNvbnN0IEVQU0lMT04gPSAwLjAwMTtcclxuXHJcbmV4cG9ydCBjbGFzcyBXb3JsZE1hcCBleHRlbmRzIFBJWEkuQ29udGFpbmVyIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgd29ybGQ6IFdvcmxkLCBwdWJsaWMgZHVuZ2VvbjogRHVuZ2VvbiwgcHVibGljIHByb3ZpZGVyOiBJVGlsZVByb3ZpZGVyKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICBpZiAoIXByb3ZpZGVyLmlzUmVhZHkoKSkgdGhyb3cgbmV3IEVycm9yKFwiUHJvdmlkZXIgaXMgbm90IHJlYWR5XCIpO1xyXG4gICAgICAgIGxldCB0ZXggPSBQSVhJLlJlbmRlclRleHR1cmUuY3JlYXRlKGR1bmdlb24ud2lkdGggKiBUSUxFX1NJWkUsIGR1bmdlb24uaGVpZ2h0ICogVElMRV9TSVpFKTtcclxuICAgICAgICBsZXQgY29udGFpbmVyID0gbmV3IFBJWEkuQ29udGFpbmVyKCk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkdW5nZW9uLndpZHRoOyBpICsrKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZHVuZ2Vvbi5oZWlnaHQ7IGogKyspIHtcclxuICAgICAgICAgICAgICAgIGxldCB0aWxlID0gcHJvdmlkZXIuZ2V0VGlsZShkdW5nZW9uLCBpLCBqKTtcclxuICAgICAgICAgICAgICAgIHRpbGUueCA9IGkgKiBUSUxFX1NJWkU7XHJcbiAgICAgICAgICAgICAgICB0aWxlLnkgPSBqICogVElMRV9TSVpFO1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENoaWxkKHRpbGUpO1xyXG4gICAgICAgICAgICAgICAgLy8gdGlsZS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcm9vdC5hcHAucmVuZGVyZXIucmVuZGVyKGNvbnRhaW5lciwgdGV4KTtcclxuICAgICAgICBjb250YWluZXIuZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMuYWRkQ2hpbGQobmV3IFBJWEkuU3ByaXRlKHRleCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBtb3ZlKGFjdG9yOiBBY3Rvcikge1xyXG4gICAgICAgIGxldCBjb2xsaXNpb25zID0gWzAsIDBdO1xyXG5cclxuICAgICAgICBsZXQgeHYgPSBhY3Rvci52ZWxvY2l0eS54O1xyXG4gICAgICAgIHdoaWxlICh4diAhPT0gMCkge1xyXG4gICAgICAgICAgICBsZXQgbW92ZSA9IE1hdGgubWF4KE1hdGgubWluKFRJTEVfU0laRSwgeHYpLCAtVElMRV9TSVpFKTtcclxuICAgICAgICAgICAgYWN0b3IueCArPSBtb3ZlO1xyXG4gICAgICAgICAgICB4diAtPSBtb3ZlO1xyXG4gICAgICAgICAgICBsZXQgbGVmdCA9IE1hdGguZmxvb3IoYWN0b3IubGVmdCAvIFRJTEVfU0laRSk7XHJcbiAgICAgICAgICAgIGxldCByaWdodCA9IE1hdGguZmxvb3IoYWN0b3IucmlnaHQgLyBUSUxFX1NJWkUpO1xyXG4gICAgICAgICAgICBsZXQgdG9wID0gTWF0aC5mbG9vcihhY3Rvci50b3AgLyBUSUxFX1NJWkUpO1xyXG4gICAgICAgICAgICBsZXQgYm90dG9tID0gTWF0aC5mbG9vcihhY3Rvci5ib3R0b20gLyBUSUxFX1NJWkUpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gdG9wOyBpIDw9IGJvdHRvbTsgaSArKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZHVuZ2Vvbi50aWxlcy5nZXQobGVmdCwgaSkgPT09IEVUaWxlcy5XQUxMIHx8IHRoaXMuZHVuZ2Vvbi50aWxlcy5nZXQocmlnaHQsIGkpID09PSBFVGlsZXMuV0FMTCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtb3ZlID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rvci5yaWdodCA9IHJpZ2h0ICogMzIgLSBFUFNJTE9OO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb25zWzBdID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rvci5sZWZ0ID0gbGVmdCAqIDMyICsgMzIgKyBFUFNJTE9OO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb25zWzBdID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHh2ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rvci52ZWxvY2l0eS54ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBsZXQgeXYgPSBhY3Rvci52ZWxvY2l0eS55O1xyXG4gICAgICAgIHdoaWxlICh5diAhPT0gMCkge1xyXG4gICAgICAgICAgICBsZXQgbW92ZSA9IE1hdGgubWF4KE1hdGgubWluKFRJTEVfU0laRSwgeXYpLCAtVElMRV9TSVpFKTtcclxuICAgICAgICAgICAgYWN0b3IueSArPSBtb3ZlO1xyXG4gICAgICAgICAgICB5diAtPSBtb3ZlO1xyXG4gICAgICAgICAgICBsZXQgbGVmdCA9IE1hdGguZmxvb3IoYWN0b3IubGVmdCAvIFRJTEVfU0laRSk7XHJcbiAgICAgICAgICAgIGxldCByaWdodCA9IE1hdGguZmxvb3IoYWN0b3IucmlnaHQgLyBUSUxFX1NJWkUpO1xyXG4gICAgICAgICAgICBsZXQgdG9wID0gTWF0aC5mbG9vcihhY3Rvci50b3AgLyBUSUxFX1NJWkUpO1xyXG4gICAgICAgICAgICBsZXQgYm90dG9tID0gTWF0aC5mbG9vcihhY3Rvci5ib3R0b20gLyBUSUxFX1NJWkUpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gbGVmdDsgaSA8PSByaWdodDsgaSArKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZHVuZ2Vvbi50aWxlcy5nZXQoaSwgdG9wKSA9PT0gRVRpbGVzLldBTEwgfHwgdGhpcy5kdW5nZW9uLnRpbGVzLmdldChpLCBib3R0b20pID09PSBFVGlsZXMuV0FMTCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtb3ZlID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rvci5ib3R0b20gPSBib3R0b20gKiAzMiAtIEVQU0lMT047XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbnNbMV0gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdG9yLnRvcCA9IHRvcCAqIDMyICsgMzIgKyBFUFNJTE9OO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb25zWzFdID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHl2ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rvci52ZWxvY2l0eS55ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gY29sbGlzaW9ucztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaXNPbkxhZGRlcihhY3RvcjogQWN0b3IpOiBib29sZWFuIHtcclxuICAgICAgICBsZXQgY2VudGVyID0gTWF0aC5mbG9vcihhY3Rvci5ob3Jpem9udGFsQ2VudGVyIC8gVElMRV9TSVpFKTtcclxuICAgICAgICBsZXQgdG9wID0gTWF0aC5mbG9vcihhY3Rvci50b3AgLyBUSUxFX1NJWkUpO1xyXG4gICAgICAgIGxldCBib3R0b20gPSBNYXRoLmZsb29yKGFjdG9yLmJvdHRvbSAvIFRJTEVfU0laRSk7XHJcblxyXG4gICAgICAgIHJldHVybiAodGhpcy5kdW5nZW9uLnRpbGVzLmdldChjZW50ZXIsIHRvcCkgPT09IEVUaWxlcy5MQURERVIgfHwgdGhpcy5kdW5nZW9uLnRpbGVzLmdldChjZW50ZXIsIGJvdHRvbSkgPT09IEVUaWxlcy5MQURERVIpO1xyXG4gICAgfVxyXG5cclxufSJdfQ==